
<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Vállgazd</title>
<style>
  :root{
    --bg:#0f172a; --card:#111827; --muted:#9ca3af; --ok:#10b981; --err:#ef4444; --pri:#60a5fa;
    --ink:#e5e7eb; --ink2:#cbd5e1; --chip:#1f2937;
  }
  html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial}
  .wrap{max-width:980px;margin:24px auto;padding:0 16px}
  .card{background:var(--card);border:1px solid #1f2937;border-radius:14px;padding:18px 18px 8px 18px;box-shadow:0 10px 30px rgba(0,0,0,.25);margin-bottom:18px}
  .h1{font-size:26px;font-weight:800;margin:2px 0 14px}
  .h2{font-size:18px;color:var(--ink2);margin:0 0 10px}
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  .btn{appearance:none;border:1px solid #334155;background:#0b1220;color:var(--ink);padding:10px 14px;border-radius:10px;cursor:pointer;font-weight:700}
  .btn:hover{border-color:#475569;background:#0c1a33}
  .btn.primary{background:linear-gradient(180deg,#1d4ed8,#1e40af);border-color:#1e3a8a}
  .btn.ghost{background:transparent;border-color:#334155}
  .btn.small{padding:6px 10px;font-size:13px}
  .meta{color:var(--muted);font-size:13px}
  .q{margin:8px 0 10px}
  .opt{display:flex;gap:8px;align-items:flex-start;padding:8px 10px;border-radius:10px;border:1px solid #1f2937;background:#0a1324;margin:6px 0}
  .opt input{margin-top:2px}
  .opt.correct{border-color:rgba(16,185,129,.6);background:rgba(16,185,129,.08)}
  .opt.incorrect{border-color:rgba(239,68,68,.6);background:rgba(239,68,68,.08)}
  .pill{display:inline-block;background:var(--chip);border:1px solid #334155;color:var(--ink2);font-size:12px;border-radius:999px;padding:3px 9px;margin-right:6px}
  .footer{display:flex;justify-content:space-between;align-items:center;margin-top:16px;border-top:1px dashed #334155;padding-top:10px}
  input[type="text"]{width:100%;padding:10px;border-radius:10px;border:1px solid #1f2937;background:#0b1220;color:var(--ink)}
  .score{font-size:18px;font-weight:800}
  .tag{font-size:12px;color:#93c5fd}
  .hidden{display:none}
  .tabs .btn.active{border-color:#1e3a8a; background:#0c1a33}
  .list-item{padding:8px;border-bottom:1px dashed #334155}
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <div class="h1">Gazdjog gyakorló teszt</div>
    <div class="row tabs" style="margin-top:10px">
      <button id="startBtn" class="btn primary" type="button">Új teszt indítása (20 véletlen kérdés)</button>
      <button id="showAllBtn" class="btn ghost" type="button">Összes kérdés listázása (tanuláshoz)</button>
      <button id="unseenTabBtn" class="btn ghost" type="button">Még nem tanult kérdéseim</button>
      <button id="mistakesTabBtn" class="btn ghost" type="button">Hibáim (rossz válaszok)</button>
    </div>
  </div>

  <div id="testContainer"></div>

  <div id="resultCard" class="card hidden">
    <div class="h1">Eredmény</div>
    <div id="scoreLine" class="score"></div>
    <div id="detailLine" class="meta" style="margin-top:6px"></div>
    <div class="row" style="margin-top:12px; flex-wrap:wrap; gap:10px;">
      <button class="btn primary" id="restartBtn" type="button">Új, véletlen 20 kérdés</button>
      <button class="btn" id="reviewBtn" type="button">Összes (aktuális) kérdés megoldásának mutatása</button>
      <button class="btn ghost" id="resultPracticeMistakesBtn" type="button">Hibáim tanulása ()</button>
    </div>
  </div>

  <div id="bulkCard" class="card hidden">
    <div class="h2">Gyors ellenőrzés és gyakorlás</div>
    <div class="meta">Ezekkel gyorsan újratanulhatod a hibáidat.</div>
    <div class="row" style="margin-top:10px; flex-wrap:wrap; gap:12px;">
      <button class="btn ghost" id="practiceMistakesBtn" type="button">Hibáim tanulása (10 véletlen kérdés)</button>
      <button class="btn" id="practiceMistakesAll" type="button">Összes hibám gyakorlása</button>
    </div>
  </div>

  <!-- Hibáim -->
  <div id="mistakesCard" class="card hidden">
    <div class="h2">Hibáim – gyakorló lista</div>
    <div class="meta" id="mistakesMeta">Még nincs rögzített hibád.</div>
    <div class="row" style="margin:10px 0">
      <button id="practiceMistakes10" class="btn" type="button">Gyakorlás a hibáimból (10)</button>
      <button id="practiceMistakes20" class="btn" type="button">Gyakorlás a hibáimból (30)</button>
      <button id="clearMistakesBtn" class="btn ghost" type="button">Hibalista törlése</button>
    </div>
    <div id="mistakesList"></div>
  </div>

  <!-- Még nem tanult -->
  <div id="unseenCard" class="card hidden">
    <div class="h2">Még nem tanult kérdéseim</div>
    <div class="meta" id="unseenMeta">Betöltés…</div>
    <div class="row" style="margin:10px 0">
      <button id="practiceUnseen10" class="btn" type="button">Gyakorlás (10 véletlen)</button>
      <button id="practiceUnseen20" class="btn" type="button">Gyakorlás (80 véletlen)</button>
      <button id="clearSeenBtn" class="btn ghost" type="button">„Megnézettek” törlése</button>
    </div>
    <div id="unseenList"></div>
  </div>
</div>

<script>
 
const QUESTION_BANK=[
  // --- Csődeljárás, felszámolás, szerkezetátalakítás ---

  {
    id:"csod-mc-001",
    type:"mcq",
    multi:false,
    topic:"Csődeljárás, szerkezetátalakítás",
    text:"Melyik eljárás kapcsolódik a fizetésképtelenség valószínűségéhez?",
    options:[
      "Csődeljárás",
      "Felszámolási eljárás",
      "Szerkezetátalakítási eljárás",
      "Végelszámolás"
    ],
    correct:[2]
  },
  {
    id:"csod-mc-002",
    type:"mcq",
    multi:true,
    topic:"Szerkezetátalakítási eljárás",
    text:"Mi a célja a szerkezetátalakítási eljárásnak?",
    options:[
      "A vállalkozás megszüntetése",
      "A fizetésképtelenség megelőzése",
      "A hitelezők teljes kielégítése",
      "A gazdálkodás konszolidálása"
    ],
    correct:[1,3]
  },
  {
    id:"csod-mc-003",
    type:"mcq",
    multi:false,
    topic:"Csődeljárás",
    text:"Ki kezdeményezheti a csődeljárást?",
    options:[
      "Csak az adós",
      "Csak a hitelező",
      "Az adós és a hitelező egyaránt",
      "A cégbíróság hivatalból"
    ],
    correct:[0]
  },
  {
    id:"csod-mc-004",
    type:"mcq",
    multi:false,
    topic:"Csődjog",
    text:"Melyik törvény szabályozza a csődeljárást és a felszámolási eljárást?",
    options:[
      "2021. évi LXIV. törvény",
      "1991. évi XLIX. törvény",
      "2013. évi V. törvény",
      "2006. évi IV. törvény"
    ],
    correct:[1]
  },
  {
    id:"csod-mc-005",
    type:"mcq",
    multi:false,
    topic:"Felszámolási eljárás",
    text:"Melyik bíróság illetékes a felszámolási eljárásban?",
    options:[
      "A Kúria",
      "A törvényszékek",
      "A járásbíróságok",
      "Az ítélőtáblák"
    ],
    correct:[1]
  },
  {
    id:"csod-mc-006",
    type:"mcq",
    multi:true,
    topic:"Csődeljárás",
    text:"Mi történik a csődeljárás megindításakor?",
    options:[
      "Az adós fizetési haladékot kap (moratórium)",
      "Automatikusan felszámolási eljárás indul",
      "A cégnevéhez a „cs. a.” toldat kerül",
      "A hitelezők automatikusan kielégítést kapnak"
    ],
    correct:[0,2]
  },
  {
    id:"csod-mc-007",
    type:"mcq",
    multi:true,
    topic:"Moratórium",
    text:"Melyik eljárásban van moratórium?",
    options:[
      "Csődeljárás",
      "Felszámolási eljárás",
      "Végelszámolás",
      "Szerkezetátalakítási eljárás"
    ],
    correct:[0,3]
  },
  {
    id:"csod-mc-008",
    type:"mcq",
    multi:true,
    topic:"Moratórium",
    text:"Mire nem vonatkozik a moratórium?",
    options:[
      "Munkabér",
      "Közműdíjak",
      "Áruhiteltartozások",
      "A vagyonfelügyelő díja"
    ],
    correct:[0,1,3]
  },
  {
    id:"csod-mc-009",
    type:"mcq",
    multi:true,
    topic:"Csődeljárás",
    text:"Mikor nem indulhat csődeljárás?",
    options:[
      "Ha az adóssal szemben felszámolási eljárás már folyamatban van",
      "Ha az adós nem fizet",
      "Ha szerkezetátalakítási terv végrehajtása folyamatban van",
      "Ha az adós nem nyújt be csődeljárás iránti kérelmet"
    ],
    correct:[0,2,3]
  },
  {
    id:"csod-mc-010",
    type:"mcq",
    multi:true,
    topic:"Pénzügyi reorganizáció",
    text:"Mi a célja a pénzügyi reorganizációnak?",
    options:[
      "A társaság megszüntetése",
      "A felszámolási eljárás megelőzése",
      "A hitelezők gyors kielégítése",
      "A pénzügyi struktúra új alapokra helyezése"
    ],
    correct:[1,3]
  },
  {
    id:"csod-mc-011",
    type:"mcq",
    multi:true,
    topic:"Csődeljárás szereplői",
    text:"Ki működik közre a csődeljárásban?",
    options:[
      "A bíróság",
      "A szerkezetátalakítási szakértő",
      "A felszámoló",
      "A vagyonfelügyelő"
    ],
    correct:[0,3]
  },
  {
    id:"csod-mc-012",
    type:"mcq",
    multi:false,
    topic:"Csődeljárás",
    text:"Melyik eljárásban van egyezségi tárgyalás?",
    options:[
      "Csődeljárás",
      "Felszámolási eljárás",
      "Szerkezetátalakítási eljárás",
      "Végelszámolás"
    ],
    correct:[0]
  },
  {
    id:"csod-mc-013",
    type:"mcq",
    multi:false,
    topic:"Felszámolási eljárás",
    text:"Melyik eljárásban lehet felszámolót kirendelni?",
    options:[
      "Csődeljárás",
      "Felszámolási eljárás",
      "Szerkezetátalakítási eljárás",
      "Végelszámolás"
    ],
    correct:[1]
  },
  {
    id:"csod-mc-014",
    type:"mcq",
    multi:false,
    topic:"Felszámoló",
    text:"Melyik szervezet lehet felszámoló?",
    options:[
      "Bármely gazdasági társaság",
      "Csak az állam",
      "A felszámolók névjegyzékében szereplő szervezet",
      "A cégbíróság által kijelölt magánszemély"
    ],
    correct:[2]
  },
  {
    id:"csod-mc-015",
    type:"mcq",
    multi:false,
    topic:"Ideiglenes vagyonfelügyelő",
    text:"Mikor rendelhető ki ideiglenes vagyonfelügyelő?",
    options:[
      "Ha az adós kéri",
      "Ha egy hitelező valószínűsíti a követelésének veszélyeztetettségét",
      "Ha a bíróság hivatalból elrendeli",
      "Ha a pénzügyi reorganizációs terv sikertelen volt"
    ],
    correct:[1]
  },
  {
    id:"csod-mc-016",
    type:"mcq",
    multi:true,
    topic:"Csődeljárás",
    text:"Mi történik, ha az egyezség nem jön létre a csődeljárásban?",
    options:[
      "A bíróság megszünteti a csődeljárást",
      "Felszámolási eljárás indul",
      "Az adós mentesül tartozásai alól",
      "Új csődeljárás indul automatikusan"
    ],
    correct:[0,1]
  },
  {
    id:"csod-mc-017",
    type:"mcq",
    multi:false,
    topic:"Felszámolási eljárás",
    text:"Melyik eljárásban van lehetőség egyszerűsített felszámolásra?",
    options:[
      "Csődeljárás",
      "Felszámolási eljárás",
      "Szerkezetátalakítási eljárás",
      "Végelszámolás"
    ],
    correct:[1]
  },
  {
    id:"csod-mc-018",
    type:"mcq",
    multi:true,
    topic:"Fizetésképtelenség",
    text:"Mikor állapítja meg a bíróság az adós fizetésképtelenségét?",
    options:[
      "Ha az adós a hitelező követelését nem vitatja",
      "Ha az adós a fizetési felszólítást követő 20 napon belül sem teljesít",
      "Ha a hitelező nem nyújt be kérelmet",
      "Ha a végrehajtás eredménytelen volt"
    ],
    correct:[1,3]
  },
  {
    id:"csod-mc-019",
    type:"mcq",
    multi:false,
    topic:"Felszámolási eljárás",
    text:"Mi a felszámolási eljárás célja?",
    options:[
      "A társaság pénzügyi reorganizációja",
      "A fizetésképtelenség megszüntetése",
      "A gazdálkodó szervezet jogutód nélküli megszüntetése",
      "A hitelezők követeléseinek teljes kielégítése"
    ],
    correct:[2]
  },
  {
    id:"csod-mc-020",
    type:"mcq",
    multi:false,
    topic:"Vezető tisztségviselő felelőssége",
    text:"Mikor lehet megállapítási keresetet benyújtani a volt vezető ellen?",
    options:[
      "A felszámolás jogerős lezárását követő 60 napon belül",
      "A csődeljárás alatt",
      "A reorganizációs terv elfogadása után",
      "A felszámolási zárómérleg benyújtása után"
    ],
    correct:[0]
  }
];

QUESTION_BANK.push(
  // --- Kötelem, szerződések, kártérítés ---

  {
    id:"kotel-mc-001",
    type:"mcq",
    multi:true,
    topic:"Kötelmi jogviszony",
    text:"Mi jellemzi a kötelmi jogviszonyt?",
    options:[
      "Meghatározott személyek között áll fenn",
      "A szolgáltatásnak nincs vagyoni értéke",
      "A felek mellérendeltek",
      "A kötelezett vagyonával felel a teljesítésért"
    ],
    correct:[0,2,3]
  },
  {
    id:"kotel-mc-002",
    type:"mcq",
    multi:true,
    topic:"Kártérítési felelősség",
    text:"Melyek a kártérítési felelősség előfeltételei?",
    options:[
      "Kár",
      "Jogellenesség",
      "Okozati összefüggés",
      "Szerződéskötés"
    ],
    correct:[0,1,2]
  },
  {
    id:"kotel-mc-003",
    type:"mcq",
    multi:true,
    topic:"Kártérítési felelősség",
    text:"Mely esetekben nem jogellenes a károkozás?",
    options:[
      "Ha a kár okozását jogszabály megengedi",
      "Ha szükséghelyzetben arányos kárt okoznak",
      "Ha a károsult a károkozásba beleegyezett",
      "Ha a károkozó szándékosan járt el"
    ],
    correct:[0,1,2]
  },
  {
    id:"kotel-mc-004",
    type:"mcq",
    multi:true,
    topic:"Vállalkozási szerződés",
    text:"Jelölje meg, a vállalkozási szerződés alapján a vállalkozót a Ptk. alapján megillető jogokat!",
    options:[
      "A vállalkozót zálogjog illeti meg",
      "Indokolt többletmunkát jogosult elvégezni",
      "Indokolt pótmunka elvégzése kötelező számára",
      "Vállalkozói díj illeti meg"
    ],
    correct:[0,3]
  },
  {
    id:"kotel-mc-005",
    type:"mcq",
    multi:true,
    topic:"Szerződés fogalma",
    text:"Mi a szerződés fogalma a Ptk. szerint?",
    options:[
      "A felek egyoldalú jognyilatkozata",
      "A felek kölcsönös és egybehangzó jognyilatkozata",
      "Joghatás kiváltására irányuló megállapodás",
      "Csak írásban köthető érvényesen"
    ],
    correct:[1,2]
  },
  {
    id:"kotel-mc-006",
    type:"mcq",
    multi:true,
    topic:"Adásvételi szerződés",
    text:"Melyek az adásvételi szerződés lényeges elemei?",
    options:[
      "Az eladó és a vevő személye",
      "Tulajdonátruházási szándék",
      "A vételár meghatározása",
      "Írásbeliség"
    ],
    correct:[0,1,2]
  },
  {
    id:"kotel-mc-007",
    type:"mcq",
    multi:true,
    topic:"Szerződés megerősítése",
    text:"Milyen szerződés megerősítőket sorol fel a Ptk.?",
    options:[
      "Jogvesztés kikötése",
      "Előleg",
      "Kötbér",
      "Foglaló"
    ],
    correct:[0,2,3]
  },
  {
    id:"kotel-mc-008",
    type:"mcq",
    multi:false,
    topic:"Ajándékozás",
    text:"Jelölje meg, hogy az ajándék mennyi időn belül követelhető vissza a megfelelő feltételek teljesülése esetén!",
    options:[
      "Általános elévülési időn belül",
      "Egy éven belül",
      "Három éven belül",
      "Nem követelhető vissza"
    ],
    correct:[0]
  },
  {
    id:"kotel-mc-009",
    type:"mcq",
    multi:true,
    topic:"Kellékszavatosság",
    text:"Milyen jellemzői vannak a kellékszavatosságnak?",
    options:[
      "Fogyasztó és vállalkozás között is fennállhat",
      "Hibás szolgáltatás esetén érvényesíthető",
      "Csak ingóságokra vonatkozhat",
      "Hibás áru cseréjét is lehet követelni"
    ],
    correct:[0,1,3]
  },
  {
    id:"kotel-mc-010",
    type:"mcq",
    multi:true,
    topic:"Vállalkozási szerződés",
    text:"Mi jellemzi a vállalkozási szerződést?",
    options:[
      "A megrendelőnek utasítási joga van",
      "A megrendelő biztosítja a munkavégzés helyét",
      "A többletmunkát minden esetben el kell végezni",
      "A vállalkozói díj magában foglalja a munka és az anyag költségét is"
    ],
    correct:[0,3]
  },
  {
    id:"kotel-mc-011",
    type:"mcq",
    multi:true,
    topic:"Vállalkozási szerződés",
    text:"Jelölje meg, hogy a vállalkozó hogyan köteles a tevékenység végzésének feltételeit megszervezni a Ptk. szerint!",
    options:[
      "Biztosítania kell a tevékenység biztonságos befejezését",
      "Biztosítania kell, hogy határidőre befejezze",
      "Biztosítania kell a gazdaságos elvégzést",
      "Biztosítania kell a szakszerű elvégzést"
    ],
    correct:[0,1,2,3]
  },
  {
    id:"kotel-mc-012",
    type:"mcq",
    multi:true,
    topic:"Kártérítési felelősség",
    text:"Mit jelent a kártérítési felelősség?",
    options:[
      "Aki kárt okoz, köteles a kárt megtéríteni",
      "Aki jogellenesen kárt okoz, köteles a kárt megtéríteni",
      "A teljes kárt kell megtéríteni (az elmaradt hasznot is)",
      "A teljes kár a dolog értékcsökkenését és a javítási költséget jelenti"
    ],
    correct:[1,2]
  },
  {
    id:"kotel-mc-013",
    type:"mcq",
    multi:true,
    topic:"Érvénytelenség",
    text:"Jelölje meg a semmis szerződés eseteit!",
    options:[
      "Színlelt szerződés",
      "Jó erkölcsbe ütköző szerződés",
      "Uzsorás szerződés",
      "Lehetetlen szolgáltatásra irányuló szerződés"
    ],
    correct:[0,1,2,3]
  },
  {
    id:"kotel-mc-014",
    type:"mcq",
    multi:false,
    topic:"Ajándékozás",
    text:"Melyek az ajándékozás jellemzői?",
    options:[
      "Az adott ajándékot nem lehet visszakérni",
      "Ha az ajándékozó meggondolja magát, visszakérheti",
      "Az ajándékozás kétoldalú jogügylet",
      "Csak kis értékű ingóságot lehet ingyenesen átruházni"
    ],
    correct:[2]
  },
  {
    id:"kotel-mc-015",
    type:"mcq",
    multi:true,
    topic:"Kötelmet keletkeztető tények",
    text:"Jelölje meg a kötelemkeletkeztető jogi tényeket!",
    options:[
      "Szerződésből",
      "Utaló magatartásból",
      "Károkozásból",
      "Egyoldalú jognyilatkozatból",
      "Érvénytelenségből"
    ],
    correct:[0,1,2,3]
  },
  {
    id:"kotel-mc-016",
    type:"mcq",
    multi:true,
    topic:"Szerződés megszűnése",
    text:"Jelölje meg a szerződés megszűnésének eseteit!",
    options:[
      "A szolgáltatás teljesítésével",
      "Személyegyesüléssel",
      "A kötelezett jogutód nélküli megszűnésével",
      "Hibás teljesítéssel",
      "A kötelezett késedelmével"
    ],
    correct:[0,1,2]
  },
  {
    id:"kotel-mc-017",
    type:"mcq",
    multi:true,
    topic:"Szerződéstípusok",
    text:"Jelölje meg, hogy melyek minősülnek vállalkozási szerződésnek!",
    options:[
      "Bizományi szerződés",
      "Szállítmányozási szerződés",
      "Fuvarozási szerződés",
      "Kutatási szerződés"
    ],
    correct:[2,3]
  },
  {
    id:"kotel-mc-018",
    type:"mcq",
    multi:true,
    topic:"Kötbér",
    text:"Jelölje meg, hogy mely állítás vagy állítások jellemzik a kötbért!",
    options:[
      "Írásban köthető ki",
      "A bíróság nem mérsékelheti",
      "Kárátalány funkciót tölt be",
      "Kötbér után kamat kikötése semmis",
      "Bánatpénzt jelent"
    ],
    correct:[0,2,3]
  },
  {
    id:"kotel-mc-019",
    type:"mcq",
    multi:true,
    topic:"Bérleti szerződés",
    text:"Jelölje meg, hogy melyek a bérbeadó jogai!",
    options:[
      "Ellenőrizheti a bérelt dolog használatát",
      "Zálogjog illeti meg a bérleti díj erejéig",
      "Felmondhatja a szerződést, ha a bérlő nem fizet",
      "Fegyelmezési jog illeti meg a bérlővel szemben"
    ],
    correct:[0,1,2]
  },
  {
    id:"kotel-mc-020",
    type:"mcq",
    multi:true,
    topic:"Szerződés megerősítése",
    text:"Jelölje meg, hogy milyen jogintézményeket nevez meg a Ptk. a szerződés megerősítésére!",
    options:[
      "Jogvesztés kikötése",
      "Kezesség",
      "Foglaló",
      "Kötbér",
      "Előleg"
    ],
    correct:[0,2,3]
  },
  {
    id:"kotel-mc-021",
    type:"mcq",
    multi:false,
    topic:"Foglaló",
    text:"Jelölje meg, hogy milyen formában adható a foglaló!",
    options:[
      "Dolog",
      "Jog",
      "Pénz"
    ],
    correct:[2]
  },
  {
    id:"kotel-mc-022",
    type:"mcq",
    multi:true,
    topic:"Foglaló",
    text:"Jelölje meg, hogy melyik vagy melyek igazak a foglalóra!",
    options:[
      "A kötelezettségvállalás megerősítését szolgálja",
      "A bíróság mérsékelheti a foglaló összegét",
      "Kötelező írásban rögzíteni",
      "Az írásbeliség nem kötelező",
      "Mértékét a Ptk. nem határozza meg"
    ],
    correct:[0,1,3,4]
  },
  {
    id:"kotel-mc-023",
    type:"mcq",
    multi:true,
    topic:"Kellékszavatosság",
    text:"Jelölje meg, hogy a kellékszavatossági igény alapján a jogosult mit tehet, illetve mit igényelhet!",
    options:[
      "Kijavítást kérhet",
      "Kicserélést kérhet",
      "Arányos árleszállítást kérhet",
      "A szerződéstől elállhat"
    ],
    correct:[0,1,2,3]
  },
  {
    id:"kotel-mc-024",
    type:"mcq",
    multi:true,
    topic:"Tulajdonátruházó szerződések",
    text:"Jelölje meg, hogy melyek tartoznak a tulajdonátruházó szerződések közé!",
    options:[
      "Adásvételi szerződés",
      "Bizományosi szerződés",
      "Csere szerződés",
      "Ajándékozási szerződés"
    ],
    correct:[0,2,3]
  },
  {
    id:"kotel-mc-025",
    type:"mcq",
    multi:true,
    topic:"Szerződésszegés",
    text:"Jelölje meg a szerződésszegés eseteit!",
    options:[
      "A kötelezett késedelme",
      "A jogosult átvételi késedelme",
      "Hibás teljesítés",
      "A teljesítés megtagadása",
      "A teljesítés lehetetlenné válása"
    ],
    correct:[0,1,2,3,4]
  }
);


const QUESTIONS = QUESTION_BANK;

// ===========================================================================

/* ======= KIS SEGÉDEK ======= */
const shuffle = arr => arr.map(v=>[Math.random(),v]).sort((a,b)=>a[0]-b[0]).map(x=>x[1]);
const pickRandom = (arr, n) => shuffle(arr).slice(0, n);


function normalize(s){
  return (s ?? "")
    .toString()
    .trim()
    .toLowerCase()
    .normalize("NFD")              
    .replace(/[\u0300-\u036f]/g, "") 
    .replace(/\s+/g, " ");           
}
function levenshtein(a, b){
  const m = a.length, n = b.length;
  const dp = Array.from({length: m+1}, () => Array(n+1).fill(0));
  for(let i=0;i<=m;i++) dp[i][0] = i;
  for(let j=0;j<=n;j++) dp[0][j] = j;
  for(let i=1;i<=m;i++){
    for(let j=1;j<=n;j++){
      const cost = a[i-1] === b[j-1] ? 0 : 1;
      dp[i][j] = Math.min(
        dp[i-1][j] + 1,     // törlés
        dp[i][j-1] + 1,     // beszúrás
        dp[i-1][j-1] + cost // csere
      );
    }
  }
  return dp[m][n];
}

function isAcceptable(userInput, accepted){
  const variants = Array.isArray(accepted) ? accepted : String(accepted).split("|");
  const u = normalize(userInput);
  return variants.some(v => {
    const t = normalize(v);
    if (!t) return false;
    if (u === t) return true;
    return levenshtein(u, t) <= 3; 
  });
}


let currentSet = [];
let score = 0;
let answered = 0;

/* ======= LocalStorage kulcsok ======= */
const LS_MISTAKES = "gazdjog_mistakes_min_v1";
const LS_SEEN     = "gazdjog_seen_min_v1";

/* ======= Hibák tárolása ======= */
function loadMistakes(){
  try{
    const raw = localStorage.getItem(LS_MISTAKES);
    const parsed = raw ? JSON.parse(raw) : [];
    const bankIds = new Set(QUESTIONS.map(q=>q.id));
    return parsed.filter(q=>bankIds.has(q.id));
  }catch(e){ return []; }
}
function saveMistakes(list){ localStorage.setItem(LS_MISTAKES, JSON.stringify(list)); }
function removeMistake(id){
  const list = loadMistakes().filter(x => x.id !== id);
  saveMistakes(list);
}
function addMistake(q){
  const list = loadMistakes();
  if(!list.find(x=>x.id===q.id)){ list.push(q); saveMistakes(list); }
}
function clearMistakes(){ saveMistakes([]); }

/* ======= Seen (látott kérdések) ======= */
function loadSeen(){
  try{
    const raw = localStorage.getItem(LS_SEEN);
    const arr = raw ? JSON.parse(raw) : [];
    const bankIds = new Set(QUESTIONS.map(q=>q.id));
    return new Set(arr.filter(id => bankIds.has(id)));
  }catch(e){ return new Set(); }
}
function saveSeen(seenSet){
  localStorage.setItem(LS_SEEN, JSON.stringify([...seenSet]));
}
function addSeen(ids){
  const seen = loadSeen();
  ids.forEach(id => seen.add(id));
  saveSeen(seen);
}
function clearSeen(){ localStorage.removeItem(LS_SEEN); }

/* ======= UI elemek ======= */
const testContainer = document.getElementById('testContainer');
const resultCard = document.getElementById('resultCard');
const scoreLine = document.getElementById('scoreLine');
const detailLine = document.getElementById('detailLine');

const bulkCard = document.getElementById('bulkCard');

const mistakesCard = document.getElementById('mistakesCard');
const mistakesMeta = document.getElementById('mistakesMeta');
const mistakesList = document.getElementById('mistakesList');

const unseenCard = document.getElementById('unseenCard');
const unseenMeta = document.getElementById('unseenMeta');
const unseenList = document.getElementById('unseenList');

/* ======= Helper: Hibaszámláló frissítése a gombon ======= */
function updateResultMistakesBtn(){
  const n = loadMistakes().length;
  const btn1 = document.getElementById('resultPracticeMistakesBtn');
  const btn2 = document.getElementById('practiceMistakesBtn');
  if (btn1) btn1.textContent = `Hibáim tanulása (${n})`;
  if (btn2) btn2.textContent = `Hibáim tanulása (10 véletlen kérdés)`;
}

/* ======= Teszt render ======= */
function renderTest(questions){
  bulkCard?.classList.remove('hidden');
  testContainer.innerHTML = "";

  // lapok elrejtése
  resultCard.classList.add('hidden');
  mistakesCard.classList.add('hidden');
  unseenCard.classList.add('hidden');
  document.querySelectorAll('.tabs .btn').forEach(b=>b.classList.remove('active'));

  score = 0; answered = 0;
  currentSet = questions.slice();

  questions.forEach((q, idx)=>{
    const card = document.createElement('div');
    card.className = 'card';
    card.id = `q-${q.id}`;

    const header = document.createElement('div');
    header.innerHTML = `<div class="row" style="justify-content:space-between">
      <div><span class="pill">${idx+1}. kérdés</span> <span class="tag">${q.topic||""}</span></div>
      <div class="meta">${q.type==="mcq" ? (q.multi? "Több válasz lehetséges":"Egy válasz") : "Kitöltős"}</div>
    </div>`;
    card.appendChild(header);

    const qDiv = document.createElement('div');
    qDiv.className = 'q';
    qDiv.textContent = q.text;
    card.appendChild(qDiv);

    const answersWrap = document.createElement('div');
    if(q.type === "mcq"){
      (q.options||[]).forEach((opt, i)=>{
        const optDiv = document.createElement('label');
        optDiv.className = 'opt';
        const input = document.createElement('input');
        input.type = q.multi ? 'checkbox' : 'radio';
        input.name = `ans-${q.id}`;
        input.value = i;
        optDiv.appendChild(input);
        const span = document.createElement('span');
        span.textContent = " " + ["A)","B)","C)","D)","E)","F)"][i] + " " + opt;
        optDiv.appendChild(span);
        answersWrap.appendChild(optDiv);
      });
    } else {
      const input = document.createElement('input');
      input.type = "text";
      input.placeholder = "Írd be a megoldást…";
      input.id = `fill-${q.id}`;
      answersWrap.appendChild(input);
    }
    card.appendChild(answersWrap);

    const footer = document.createElement('div');
    footer.className = 'footer';
    footer.innerHTML = `<div class="meta" id="fb-${q.id}"></div>
      <div class="row">
        <button class="btn small ghost" data-action="show-solution" data-qid="${q.id}">Megoldás mutatása</button>
        <button class="btn small" data-action="check" data-qid="${q.id}">Ellenőrzés</button>
      </div>`;
    card.appendChild(footer);

    testContainer.appendChild(card);
  });

  updateResultMistakesBtn();
}

/* ======= Kártya gombjai – egyszeri delegálás ======= */
if (!window.__cardsBound){
  testContainer.addEventListener('click', (ev)=>{
    const btn = ev.target.closest('button[data-action]');
    if(!btn) return;
    const qid = btn.getAttribute('data-qid');
    const action = btn.getAttribute('data-action');
    const q = currentSet.find(x=>x.id===qid);
    if(!q) return;

    if(action === "check"){
      handleCheck(q);
    }else if(action === "show-solution"){
      showSolution(q, true);
    }
  });
  window.__cardsBound = true;
}

/* ======= Ellenőrzés / Megoldás ======= */
function handleCheck(q){
  addSeen([q.id]);
  const card = document.getElementById(`q-${q.id}`);
  const fb = document.getElementById(`fb-${q.id}`);
  let isCorrect = false;

  if(q.type==="mcq"){
    const inputs = [...card.querySelectorAll('input[name="ans-'+q.id+'"]')];
    const sel = inputs.filter(i=>i.checked).map(i=>parseInt(i.value,10));
    inputs.forEach(i=>{
      const wrap = i.parentElement;
      const idx = parseInt(i.value,10);
      const good = (q.correct||[]).includes(idx);
      wrap.classList.remove('correct','incorrect');
      if(good) wrap.classList.add('correct');
      if(i.checked && !good) wrap.classList.add('incorrect');
      i.disabled = true;
    });
    sel.sort((a,b)=>a-b);
    const corr = [...(q.correct||[])].sort((a,b)=>a-b);
    isCorrect = JSON.stringify(sel)===JSON.stringify(corr);

  }else{
    const input = card.querySelector('input[type="text"]');
    const given = normalize(input.value);
    const ok = (q.correct||[]).some(acc=>normalize(acc)===given);

    isCorrect = ok;
    input.disabled = true;
    if(ok){
      input.style.borderColor = "rgba(16,185,129,.8)";
      input.style.background = "rgba(16,185,129,.08)";
    }else{
      input.style.borderColor = "rgba(239,68,68,.8)";
      input.style.background = "rgba(239,68,68,.08)";
      const sol = "Megoldás: " + (q.correct||[]).join("  |  ");
      const solDiv = document.createElement('div');
      solDiv.className = 'meta';
      solDiv.textContent = sol;
      input.insertAdjacentElement('afterend', solDiv);
    }
  }

  fb.textContent = isCorrect ? "✅ Helyes válasz! +1 pont" : "❌ Nem teljesen jó.";
  if(!card.dataset.done){
    answered++;
    if(isCorrect){ score++; removeMistake(q.id); }
    else{ addMistake(q); }
    card.dataset.done = "1";
    updateResultMistakesBtn();
    if(!mistakesCard.classList.contains('hidden')) renderMistakesView();
  }

  if(answered === currentSet.length) finalizeScore();
}

function showSolution(q){
  addSeen([q.id]);
  const card = document.getElementById(`q-${q.id}`);
  const fb = document.getElementById(`fb-${q.id}`);

  if(q.type==="mcq"){
    const inputs = [...card.querySelectorAll('input[name="ans-'+q.id+'"]')];
    inputs.forEach(i=>{
      const wrap = i.parentElement;
      const idx = parseInt(i.value,10);
      const good = (q.correct||[]).includes(idx);
      wrap.classList.remove('correct','incorrect');
      if(good) wrap.classList.add('correct');
      i.disabled = true;
    });
    fb.textContent = "Megoldás kiemelve zölddel.";
  } else {
    const input = card.querySelector('input[type="text"]');
    input.disabled = true;
    const sol = "Megoldás: " + (q.correct||[]).join("  |  ");
    if(!card.querySelector('.footer .meta + .meta')){
      const solDiv = document.createElement('div');
      solDiv.className = 'meta';
      solDiv.textContent = sol;
      input.insertAdjacentElement('afterend', solDiv);
    }
    fb.textContent = "Megoldás megjelenítve.";
  }

  if(!card.dataset.done){
    answered++;
    card.dataset.done = "1";
  }
  if(answered === currentSet.length) finalizeScore();
}

function finalizeScore(){
  resultCard.classList.remove('hidden');
  const pct = Math.round((score/currentSet.length)*100);
  scoreLine.textContent = `Pontszám: ${score} / ${currentSet.length}`;
  detailLine.textContent = `Teljesítmény: ${pct}% • Helyes válasz után zöld keret, hibás után piros.`;
}

/* ======= Felső gombok – egyszeri kötés ======= */
if (!window.__topBtnsBound){
  document.getElementById('startBtn').addEventListener('click', ()=>{
    const n = Math.min(20, QUESTIONS.length);
    renderTest(pickRandom(QUESTIONS, n));
  });

  document.getElementById('showAllBtn').addEventListener('click', ()=>{
    renderTest([...QUESTIONS]);
  });

  document.getElementById('restartBtn').addEventListener('click', ()=>{
    const n = Math.min(20, QUESTIONS.length);
    renderTest(pickRandom(QUESTIONS, n));
  });

  document.getElementById('reviewBtn').addEventListener('click', ()=>{
    currentSet.forEach(q=>showSolution(q,true));
  });

  const mistakesTabBtn = document.getElementById('mistakesTabBtn');
  mistakesTabBtn.addEventListener('click', ()=>{
    renderMistakesView();
    mistakesCard.classList.remove('hidden');
    unseenCard.classList.add('hidden');
    resultCard.classList.add('hidden');
    bulkCard.classList.add('hidden');
    testContainer.innerHTML = "";
    document.querySelectorAll('.tabs .btn').forEach(b=>b.classList.remove('active'));
    mistakesTabBtn.classList.add('active');
  });

  const unseenTabBtn = document.getElementById('unseenTabBtn');
  unseenTabBtn.addEventListener('click', ()=>{
    renderUnseenView();
    unseenCard.classList.remove('hidden');
    mistakesCard.classList.add('hidden');
    resultCard.classList.add('hidden');
    bulkCard.classList.add('hidden');
    testContainer.innerHTML = "";
    document.querySelectorAll('.tabs .btn').forEach(b=>b.classList.remove('active'));
    unseenTabBtn.classList.add('active');
  });

  // Csávoka fül – CSAK a Csávoka-bankból származó kérdések
 
}

/* ======= Hibáim lap ======= */
function renderMistakesView(){
  const list = loadMistakes();
  mistakesList.innerHTML = "";
  mistakesMeta.textContent = list.length
    ? `Összes rögzített hibád: ${list.length} db.`
    : "Még nincs rögzített hibád.";
  list.forEach((q, idx)=>{
    const div = document.createElement('div');
    div.className = 'list-item';
    div.innerHTML = `<strong>${idx+1}.</strong> <em>${q.topic||""}</em> — ${q.text}`;
    mistakesList.appendChild(div);
  });
  updateResultMistakesBtn();
}

document.getElementById('practiceMistakes10').addEventListener('click', ()=>{
  const list = loadMistakes();
  if(list.length===0){ alert("Nincs még hibád. Oldj meg pár kérdést előbb!"); return; }
  renderTest(pickRandom(list, Math.min(10, list.length)));
});

document.getElementById('practiceMistakes20').addEventListener('click', ()=>{
  const list = loadMistakes();
  if(list.length===0){ alert("Nincs még hibád. Oldj meg pár kérdést előbb!"); return; }
  renderTest(pickRandom(list, Math.min(20, list.length)));
});

document.getElementById('clearMistakesBtn').addEventListener('click', ()=>{
  if(confirm("Biztosan törlöd az összes rögzített hibát?")){
    clearMistakes();
    renderMistakesView();
  }
});

/* ======= Gyors gyakorló gombok a kártyán ======= */
document.getElementById('practiceMistakesBtn').addEventListener('click', ()=>{
  const mistakes = loadMistakes();
  if(mistakes.length === 0){
    alert("Még nincsenek rögzített hibáid. Oldj meg néhány kérdést előbb!");
    return;
  }
  renderTest(pickRandom(mistakes, Math.min(10, mistakes.length)));
});

document.getElementById('practiceMistakesAll').addEventListener('click', ()=>{
  const list = loadMistakes();
  if (list.length === 0) {
    alert("Nincs még hibád. Oldj meg pár kérdést előbb!");
    return;
  }
  renderTest([...list]);
});

document.getElementById('resultPracticeMistakesBtn').addEventListener('click', ()=>{
  const mistakes = loadMistakes();
  if(mistakes.length === 0){
    alert("Még nincsenek rögzített hibáid. Oldj meg pár kérdést előbb!");
    return;
  }
  renderTest(pickRandom(mistakes, Math.min(20, mistakes.length)));
});

/* ======= UNSEEN (még nem tanult) lap ======= */
function getUnseen(){
  const seen = loadSeen();
  return QUESTIONS.filter(q => !seen.has(q.id));
}
function renderUnseenView(){
  const unseen = getUnseen();
  unseenList.innerHTML = "";
  unseenMeta.textContent = unseen.length
    ? `Még nem tanult kérdések száma: ${unseen.length} db.`
    : "Gratulálok! Minden kérdést legalább egyszer láttál.";
  unseen.forEach((q, idx) => {
    const div = document.createElement('div');
    div.className = 'list-item';
    div.innerHTML = `<strong>${idx+1}.</strong> <em>${q.topic||""}</em> — ${q.text}`;
    unseenList.appendChild(div);
  });
}

document.getElementById('practiceUnseen10').addEventListener('click', ()=>{
  const unseen = getUnseen();
  if (unseen.length===0){ alert("Nincs több új (nem látott) kérdés."); return; }
  renderTest(pickRandom(unseen, Math.min(10, unseen.length)));
});

document.getElementById('practiceUnseen20').addEventListener('click', ()=>{
  const unseen = getUnseen();
  if (unseen.length===0){ alert("Nincs több új (nem látott) kérdés."); return; }
  renderTest(pickRandom(unseen, Math.min(80, unseen.length)));
});

document.getElementById('clearSeenBtn').addEventListener('click', ()=>{
  if (confirm("Törlöd a 'már látott' kérdések listáját?")){
    clearSeen();
    renderUnseenView();
  }
});

/* ======= Init ======= */
updateResultMistakesBtn();
</script>
</body>
</html>











